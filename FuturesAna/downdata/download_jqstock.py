'''
Created on Apr 25, 2019

@author: I038825
'''
'''
Created on Mar 11, 2019

@author: I038825
'''
import jqdatasdk as jqd
import pandas as pd
import sys

jqd.auth("18621861857", "")
startdate = "2010-01-01"
enddate = "2020-01-01"

def applycode(line):
    code = line.split(".")[0]
    #print(code)
    if code[0] != "6":
        code = code + ".XSHE"
    else:
        code = code + ".XSHG"
    return code
df = pd.read_csv("./data/out.csv")
df["newcode"] = df["ts_code"].apply(applycode)
slist2 = [ x for x in df["newcode"] ]
#slist2 =  ["000905.XSHG"]
cnt = 0
print(slist2)
#download the rest tomorrow
slist2 = ['002942.XSHE', '603810.XSHG', '603086.XSHG', '600486.XSHG', '300575.XSHE', '600426.XSHG', '000408.XSHE', '002890.XSHE', '002532.XSHE', '002458.XSHE', '300761.XSHE', '002714.XSHE', '300498.XSHE', '002234.XSHE', '002868.XSHE', '002918.XSHE', '002372.XSHE', '300737.XSHE', '300715.XSHE', '002271.XSHE', '002043.XSHE', '000055.XSHE', '300755.XSHE', '002818.XSHE', '300622.XSHE', '000885.XSHE', '603032.XSHG', '603776.XSHG', '002627.XSHE', '000036.XSHE', '001979.XSHE', '600515.XSHG', '000042.XSHE', '600393.XSHG', '000002.XSHE', '002146.XSHE', '600048.XSHG', '600173.XSHG', '300782.XSHE', '300747.XSHE', '688007.XSHG', '002925.XSHE', '688020.XSHG', '002962.XSHE', '300679.XSHE', '603160.XSHG', '300752.XSHE', '002841.XSHE', '300811.XSHE', '603267.XSHG', '002947.XSHE', '603773.XSHG', '002952.XSHE', '300709.XSHE', '688025.XSHG', '002916.XSHE', '300661.XSHE', '002913.XSHE', '603228.XSHG', '300701.XSHE', '688388.XSHG', '300726.XSHE', '603327.XSHG', '600563.XSHG', '300739.XSHE', '603629.XSHG', '002937.XSHE', '002859.XSHE', '300620.XSHE', '603380.XSHG', '300602.XSHE', '603595.XSHG', '002815.XSHE', '300408.XSHE', '688011.XSHG', '000050.XSHE', '603115.XSHG', '603989.XSHG', '300689.XSHE', '002938.XSHE', '300570.XSHE', '002179.XSHE', '603393.XSHG', '600681.XSHG', '603053.XSHG', '600167.XSHG', '603706.XSHG', '603080.XSHG', '002911.XSHE', '603871.XSHG', '002120.XSHE', '603967.XSHG', '002468.XSHE', '603713.XSHG', '600233.XSHG', '002352.XSHE', '603535.XSHG', '603648.XSHG', '603444.XSHG', '300792.XSHE', '300571.XSHE', '300785.XSHE', '002555.XSHE', '603613.XSHG', '002517.XSHE', '300038.XSHE', '300113.XSHE', '603258.XSHG', '300766.XSHE', '002558.XSHE', '002174.XSHE', '002803.XSHE', '300418.XSHE', '002602.XSHE', '600887.XSHG', '600419.XSHG', '002732.XSHE', '600566.XSHG', '000538.XSHE', '600211.XSHG', '600332.XSHG', '603858.XSHG', '000423.XSHE', '600436.XSHG', '600129.XSHG', '300519.XSHE', '002737.XSHE', '600750.XSHG', '000999.XSHE', '002873.XSHE', '600771.XSHG', '002275.XSHE', '603896.XSHG', '002287.XSHE', '300776.XSHE', '300751.XSHE', '688200.XSHG', '002975.XSHE', '688001.XSHG', '603666.XSHG', '002960.XSHE', '002833.XSHE', '002884.XSHE', '300812.XSHE', '300757.XSHE', '603757.XSHG', '300756.XSHE', '688028.XSHG', '603203.XSHG', '603338.XSHG', '603638.XSHG', '603277.XSHG', '300607.XSHE', '002957.XSHE', '688022.XSHG', '688090.XSHG', '300724.XSHE', '002595.XSHE', '002366.XSHE', '300569.XSHE', '300818.XSHE', '300707.XSHE', '603076.XSHG', '300450.XSHE', '603396.XSHG', '603283.XSHG', '002757.XSHE', '300457.XSHE', '300443.XSHE', '300771.XSHE', '002955.XSHE', '300802.XSHE', '603025.XSHG', '300743.XSHE', '603496.XSHG', '300656.XSHE', '300793.XSHE', '002635.XSHE']


for sub in slist2:
    print(sub)
    df = jqd.get_price(sub, start_date=startdate, end_date=enddate, frequency='daily', fields=None, skip_paused=False, fq='pre')
    df.to_csv("./data/jqstock/s_" + sub + "_daily.csv")
    cnt+=1
